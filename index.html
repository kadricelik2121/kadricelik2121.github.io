<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>ANA SAYFA</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #FFF8E1;
      width: 100vw;
      height: 100vh;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .welcome {
      font-size: 8rem;
      font-weight: bold;
      letter-spacing: 6px;
      color: #b98d00;
      text-align: center;
      margin-bottom: 60px;
      margin-top: 0;
    }
    .b2-prufung {
      font-size: 4rem;
      font-weight: bold;
      color: hsl(51, 91%, 31%);
      letter-spacing: 3px;
      text-align: center;
      margin-bottom: 40px;
      text-transform: uppercase;
    }
    .main-rows {
      width: 90vw;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      margin-top: -25px;
    }
    .btn-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
    }
    .btn-group.left {
      align-items: flex-start;
    }
    .btn-group.right {
      align-items: flex-end;
    }
    .btn-group.center {
      align-items: center;
    }
    .btn-custom {
      font-size: 1.3rem;
      padding: 20px 48px;
      border-radius: 18px;
      border: none;
      background: #ffd400;
      color: #543c00;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 8px #0002;
      transition: background 0.25s;
      letter-spacing: 1.5px;
      min-width: 320px;
      text-align: center;
    }
    .btn-custom:hover {
      background: #ffe055;
    }
    #sifreEkrani {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #fff8e1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #icerik {
      display: none;
    }
    input[type="password"] {
      font-size: 1.2rem;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #999;
      margin-top: 10px;
      text-align: center;
    }
    button#girisBtn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 8px;
      background-color: #ffd400;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    @media (max-width: 900px) {
      .welcome { font-size: 3rem; }
      .b2-prufung { font-size: 2rem; }
      .btn-custom { min-width: 90vw; font-size: 1rem; }
      .main-rows { flex-direction: column; align-items: center; }
      .btn-group { align-items: center !important; }
    }
  </style>
<script>

  // ====== Ayarlar ======
  const VALID_PASSWORDS = ["zelal", "Bahtar", "2005"];   // izin verdiÄŸin ÅŸifreler
  const DEVICE_ID_KEY = "device_id_v1";          // bu tarayÄ±cÄ±ya ait sabit cihaz id
  const SESSION_OK_KEY = "girisYapildi";         // sessionStorage anahtarÄ±
  const SESSION_PW_HASH_KEY = "pwHash";          // sessionStorage: hangi ÅŸifre ile giriÅŸ yapÄ±ldÄ± (hash)
  const WORKER_URL = "https://nameless-resonance-c9ce.kc-kadricelik.workers.dev";

  // Bu tarayÄ±cÄ±da tekil bir cihaz kimliÄŸi Ã¼ret (ilk kez) ve sakla
  function getDeviceId() {
    let id = localStorage.getItem(DEVICE_ID_KEY);
    if (!id) {
      id = (crypto.randomUUID ? crypto.randomUUID() : (Date.now() + "-" + Math.random()));
      localStorage.setItem(DEVICE_ID_KEY, id);
    }
    return id;
  }

  // Åifreyi localStorage anahtarÄ± olarak saklamamak iÃ§in SHA-256 hash Ã¼ret
  async function sha256(text) {
    const enc = new TextEncoder().encode(text);
    const buf = await crypto.subtle.digest("SHA-256", enc);
    return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, "0")).join("");
  }

  async function showContentIfSessionValid() {
    if (sessionStorage.getItem(SESSION_OK_KEY) !== "evet") return;
    // Sekme aÃ§Ä±kken tekrar ÅŸifre sormadan iÃ§eriÄŸi gÃ¶ster
    document.getElementById("sifreEkrani").style.display = "none";
    document.getElementById("icerik").style.display = "block";
  }

  window.addEventListener("load", () => {
    // GÃ¼venlik: iÃ§erik her zaman kapalÄ± baÅŸlar, sadece kontrol sonrasÄ± aÃ§Ä±lÄ±r
    document.getElementById("sifreEkrani").style.display = "flex";
    document.getElementById("icerik").style.display = "none";
    showContentIfSessionValid();
  });

  async function kontrolEt() {
    const sifre = document.getElementById("sifre").value.trim();
    if (!sifre) {
      alert("Åifre giriniz.");
      return;
    }

    try {
      const r = await fetch(WORKER_URL + "/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password: sifre, deviceId: getDeviceId() })
      });

      const data = await r.json().catch(() => ({}));

      if (!r.ok) {
        if (r.status === 401) {
          alert("âŒ YanlÄ±ÅŸ ÅŸifre!");
          return;
        }
        if (r.status === 403 && data && data.reason === "device_mismatch") {
          alert("â›” Bu ÅŸifre baÅŸka bir cihaza baÄŸlÄ±. Bu cihazdan giriÅŸ yapÄ±lamaz.");
          return;
        }
        alert("âŒ GiriÅŸ yapÄ±lamadÄ±. (Worker hata)");
        return;
      }

      // Oturum (sekme kapatÄ±lÄ±nca biter)
      const pwHash = await sha256(sifre);
      sessionStorage.setItem(SESSION_OK_KEY, "evet");
      sessionStorage.setItem(SESSION_PW_HASH_KEY, pwHash);

      document.getElementById("sifreEkrani").style.display = "none";
      document.getElementById("icerik").style.display = "block";
    } catch (e) {
      alert("âŒ BaÄŸlantÄ± hatasÄ±. Worker URL doÄŸru mu?");
    }
  }


  // ====== ADMIN SIFIRLAMA (Ã‡Ã¶zÃ¼m 2) ======
  // KullanÄ±m:
  // 1) Ã–nce normal ÅŸifre ile giriÅŸ yap (icerik aÃ§Ä±lsÄ±n)
  // 2) Adrese #admin ekle: https://.../index.html#admin
  // 3) AÃ§Ä±lan pencerede ADMIN TOKEN (Cloudflare Secret: ADMIN_TOKEN) ve hedef ÅŸifreyi yaz.
  //
  // Not: Admin paneli sadece giriÅŸ yapÄ±ldÄ±ysa aÃ§Ä±lÄ±r.
  function showAdminPanel() {
    // Zaten aÃ§Ä±ksa tekrar aÃ§ma
    if (document.getElementById("adminWrap")) return;

    const wrap = document.createElement("div");
    wrap.id = "adminWrap";
    wrap.style.cssText = `
      position: fixed; inset: 0; background: rgba(0,0,0,.55);
      display:flex; align-items:center; justify-content:center; z-index: 100000;
      font-family: Arial, sans-serif;
    `;

    wrap.innerHTML = `
      <div style="width:min(560px,92vw); background:#fff; border-radius:14px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.25);">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
          <div style="font-size:18px; font-weight:700;">Admin Åifre SÄ±fÄ±rlama</div>
          <button id="admClose" style="padding:8px 10px; border:1px solid #ccc; background:#fff; border-radius:10px; cursor:pointer;">Kapat âœ•</button>
        </div>

        <div style="margin-top:10px; font-size:13px; color:#444;">
          Buradan <b>tek bir ÅŸifreyi</b> (Ã¶rn: <b>zelal</b>) veya <b>ALL</b> yazarak <b>tÃ¼m ÅŸifre kilitlerini</b> sÄ±fÄ±rlayabilirsin.
        </div>

        <div style="margin-top:12px;">
          <label style="font-size:12px; color:#666;">ADMIN TOKEN</label>
          <input id="admTok" type="password" autocomplete="off"
                 style="width:100%; padding:10px; border:1px solid #ccc; border-radius:10px; margin-top:6px;" />
        </div>

        <div style="margin-top:12px;">
          <label style="font-size:12px; color:#666;">SÄ±fÄ±rlanacak ÅŸifre (Ã¶rn: zelal) veya ALL</label>
          <input id="admPw" type="text" autocomplete="off" placeholder="zelal / Bahtar / 2005 / ALL"
                 style="width:100%; padding:10px; border:1px solid #ccc; border-radius:10px; margin-top:6px;" />
        </div>

        <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px;">
          <button id="admDo" style="padding:10px 14px; border:none; background:#0b57d0; color:#fff; border-radius:10px; cursor:pointer; font-weight:700;">
            SÄ±fÄ±rla
          </button>
        </div>

        <div id="admMsg" style="margin-top:12px; font-size:13px;"></div>
      </div>
    `;

    document.body.appendChild(wrap);

    const close = () => {
      const el = document.getElementById("adminWrap");
      if (el) el.remove();
      if (location.hash === "#admin") history.replaceState(null, "", location.pathname + location.search);
    };

    wrap.addEventListener("click", (e) => { if (e.target === wrap) close(); });
    wrap.querySelector("#admClose").addEventListener("click", close);

    const msg = wrap.querySelector("#admMsg");
    wrap.querySelector("#admDo").addEventListener("click", async () => {
      msg.textContent = "Ä°ÅŸlem yapÄ±lÄ±yor...";
      msg.style.color = "#333";

      const adminToken = wrap.querySelector("#admTok").value.trim();
      const targetPassword = wrap.querySelector("#admPw").value.trim();

      if (!adminToken || !targetPassword) {
        msg.textContent = "Token ve ÅŸifre/ALL boÅŸ olamaz.";
        msg.style.color = "crimson";
        return;
      }

      try {
        const r = await fetch(WORKER_URL + "/admin/reset", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ adminToken, targetPassword })
        });

        const data = await r.json().catch(() => ({}));

        if (r.ok && data && data.ok) {
          msg.textContent = "âœ… SÄ±fÄ±rlandÄ±. ArtÄ±k bu ÅŸifre yeni cihazda ilk giriÅŸ yapan kiÅŸiye baÄŸlanacak.";
          msg.style.color = "green";
        } else {
          msg.textContent = "âŒ BaÅŸarÄ±sÄ±z. Token yanlÄ±ÅŸ olabilir veya hedef ÅŸifre hatalÄ±. (" + ((data && data.reason) ? data.reason : r.status) + ")";
          msg.style.color = "crimson";
        }
      } catch (e) {
        msg.textContent = "âŒ BaÄŸlantÄ± hatasÄ±: " + (e?.message || e);
        msg.style.color = "crimson";
      }
    });
  }

  function maybeOpenAdmin() {
    // Admin panel sadece #admin varsa ve giriÅŸ yapÄ±lmÄ±ÅŸsa aÃ§Ä±lsÄ±n
    if (location.hash !== "#admin") return;

    if (sessionStorage.getItem(SESSION_OK_KEY) !== "evet") {
      alert("Admin paneli iÃ§in Ã¶nce giriÅŸ yapmalÄ±sÄ±n.");
      // hash'i temizle
      history.replaceState(null, "", location.pathname + location.search);
      return;
    }
    showAdminPanel();
  }

  window.addEventListener("hashchange", maybeOpenAdmin);
  // Sayfa aÃ§Ä±lÄ±ÅŸÄ±nda da kontrol et
  window.addEventListener("load", maybeOpenAdmin);

</script>
</head>
<body>

<div id="sifreEkrani">
  <h2>ğŸ”’ Sayfa KorumalÄ±</h2>
  <p>LÃ¼tfen ÅŸifreyi girin:</p>
  <input type="password" id="sifre" placeholder="Åifre girin">
  <button id="girisBtn" onclick="kontrolEt()">GiriÅŸ</button>
</div>

<div id="icerik">
  <div class="welcome">HOÅ GELDÄ°NÄ°Z</div>
  <div class="b2-prufung">B2 PRÃœFUNG</div>
  <div class="main-rows">
    <div class="btn-group left">
      <button class="btn-custom" onclick="window.location.href='lese1.html'">Leseverstehen Teil 1</button>
      <button class="btn-custom" onclick="window.location.href='lese2.html'">Leseverstehen Teil 2</button>
      <button class="btn-custom" onclick="window.location.href='lese3.html'">Leseverstehen Teil 3</button>
      <button class="btn-custom" onclick="window.location.href='gÃ¼nlÃ¼k konuÅŸma.html'">GÃ¼nlÃ¼k KonuÅŸma</button>
      <button class="btn-custom" onclick="window.location.href='lese0.html'">Leseverstehen Teil 11</button>
       <button class="btn-custom" onclick="window.location.href='grok8.html'">Sunummm</button>
    </div>
    <div class="btn-group center">
      <button class="btn-custom" onclick="window.location.href='sprach1.html'">Sprachbausteine Teil 1</button>
      <button class="btn-custom" onclick="window.location.href='sprach2.html'">Sprachbausteine Teil 2</button>
      <button class="btn-custom" onclick="window.location.href='wortschatz.html'">Wortschatz</button>
      <button class="btn-custom" onclick="window.location.href='wortschatz cep.html'">wortschatz cep.html</button>
    </div>
    <div class="btn-group right">
      <button class="btn-custom" onclick="window.location.href='quiz.html'">HÃ¶rverstehen Teil 1</button>
      <button class="btn-custom" onclick="window.location.href='quiz2.html'">HÃ¶rverstehen Teil 2</button>
      <button class="btn-custom" onclick="window.location.href='quiz3.html'">HÃ¶rverstehen Teil 3</button>
       <button class="btn-custom" onclick="window.location.href='quiz4.html'">HÃ¶rverstehen Karma</button>
        <button class="btn-custom" onclick="window.location.href='quiz5.html'">Karma</button>
       <button class="btn-custom" onclick="window.location.href='lÃ¶sung.html'">Etwas Planen</button>
    
    </div>
  </div>
</div>

</body>
</html>




















