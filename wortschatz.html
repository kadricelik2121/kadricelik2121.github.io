<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kelime Oyunu</title>
<style>
body {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: start;
  min-height: 100vh;
  background-color: #fff;
  padding: 20px;
  margin: 0;
  font-family: Arial, sans-serif;
  box-sizing: border-box;
}

html, body {
  height: 100%;
  width: 100%;
  overflow: hidden;
}

.options, .stats-box, .word-display, #exampleSentence, #questionText {
  max-width: 100%;
  box-sizing: border-box;
}

h1 {
  font-size: 28px;
  color: #0055aa;
}

.question {
  margin: 20px 0;
  font-weight: bold;
  font-size: 24px;
}

.word-display {
  font-size: 40px;
  font-weight: bold;
  text-align: center;
  margin: 40px 0 10px 0;
  color: #333;
}

#exampleSentence {
  font-size: 28px;
  font-style: italic;
  margin: 15px 0;
  color: #444;
  min-height: 20px;
  opacity: 0;
  transition: opacity 0.5s ease;
}

#exampleSentence.visible {
  opacity: 1;
}

.options {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  justify-content: center;
  max-width: 600px;
  margin-top: 0;
}

.option {
  width: 250px;
  height: 80px;
  padding: 20px;
  border: 3px solid #8a8a8ada;
  border-radius: 10px;
  cursor: pointer;
  font-size: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  word-wrap: break-word;
  transition: 0.3s;
}

.option.correct {
  background-color: #c8f7c5;
  border-color: green;
}

.option.incorrect {
  background-color: #f7c5c5;
  border-color: red;
}

#speaker {
  display: inline-block;
  padding: 10px 30px;
  font-size: 24px;
  background: linear-gradient(to bottom, #6d6c68, #b8b7b4);
  border: 2px solid #242321;
  border-radius: 10px;
  box-shadow: 0 4px #1b1b19;
  font-weight: bold;
  color: #111;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-align: center;
}

#speaker:active {
  box-shadow: 0 2px #a88734;
  transform: translateY(2px);
}

.stats-box {
  margin: 1px 0;
  color: rgba(0, 0, 0, 0.452); /* Siyahƒ±n %60 opaklƒ±ƒüƒ± */
  position: fixed;
  top: 1px;
  right: 1px;
  background: #f0f0f0;
  padding: 3px 6px;
  border: 2px solid #888;
  border-radius: 10px;
  font-size: 10px;
  z-index: 999;
  box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
  text-align: left;
  max-width: 120px;
  word-wrap: break-word;
  margin-bottom: 60px;
  user-select: none;
  position: fixed; /* mutable: kesinlikle fixed kalmalƒ± */
  /* Buraya ekle: */
  position: fixed;
  top: 1px;
  right: 1px;
  /* position relative kaldƒ±r, √ß√ºnk√º fixed kullanƒ±yoruz */
  /* Ancak: relative yapmamalƒ±sƒ±n, √ß√ºnk√º fixed zaten yeni konumlama yapƒ±yor */
  /* O zaman container'ƒ±n i√ßine ba≈üka bir div koyup ona relative verelim */
}

/* control-overlay i√ßin d√ºzenleme */
.control-overlay {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 10px;
  background-color: rgba(0, 128, 0, 0.2);
  color: rgba(255, 255, 255, 0.45);
  font-weight: bold;
  font-size: 12px;
  transition: background-color 0.3s ease, color 0.3s ease;
  user-select: none;
  z-index: 1000; /* ƒ∞statistik kutusundan √ºstte */
}
.control-overlay.paused {
  background-color: rgba(255, 0, 0, 0.2); /* Kƒ±rmƒ±zƒ± transparan zemin */
  color: rgba(255, 255, 255, 0.4);       /* Transparan beyaz yazƒ± */
}

#readButton {
  position: fixed;
  top: 10px;
  left: 10px;
  padding: 6px 12px;
  font-size: 16px;
  background: linear-gradient(to bottom, #a3a29f, #7a7a78);
  border: 2px solid #b8b5af;
  border-radius: 10px;
  box-shadow: 0 3px #868685;
  color: #111;
  font-weight: bold;
  cursor: pointer;
  z-index: 10000;
  transition: all 0.2s ease-in-out;
}

#readButton:active {
  box-shadow: 0 2px #a88734;
  transform: translateY(2px);
}

/* Responsive for mobile */
@media (max-width: 600px) {
  body {
    padding: 10px !important;
  }

  h1 {
    font-size: 22px !important;
  }

  .question {
    font-size: 18px !important;
    margin: 15px 0 !important;
  }

  .word-display {
    font-size: 28px !important;
    margin-bottom: 8px !important;
  }

  #exampleSentence {
    font-size: 18px !important;
    margin: 10px 0 !important;
  }

  .options {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 12px !important;
    max-width: 100% !important;
    padding: 0 5px !important;
  }

  .option {
    width: auto !important;
    min-width: 0;
    height: 60px !important;
    padding: 12px !important;
    font-size: 20px !important;
  }

  div[style*="position: fixed"] {
    display: flex !important;
    justify-content: space-between !important;
    padding: 0 10px !important;
  }

  div[style*="position: fixed"] button {
    flex: 1;
    margin: 0 6px;
    padding: 10px 12px !important;
    font-size: 16px !important;
    min-width: auto !important;
  }

  div[style*="position: fixed"] button:first-child {
    margin-left: 0;
  }
  div[style*="position: fixed"] button:last-child {
    margin-right: 0;
  }

  .stats-box {
    font-size: 12px !important;
    padding: 8px 10px !important;
  }

  #readButton {
    font-size: 14px !important;
    padding: 5px 10px !important;
  }

  #speaker {
    font-size: 18px !important;
    padding: 8px 20px !important;
  }

  #wordDisplay, #exampleSentence {
    font-size: 24px !important;
  }
}
</style>
</head>
<body>

<h1 style="font-size: 26px; color: #e07109;">Kelime Oyunu</h1>
<div class="word-display" id="wordDisplay">...</div>
<div id="speaker">üîä</div>
<div id="exampleSentence"></div>
<div class="question" id="questionText">Kelime oynatƒ±lƒ±yor...</div>

<div class="options" id="optionsContainer"></div>

<div style="text-align: center; margin-top: 0px;">

  <div style="position: fixed; bottom: 5px; left: 0; right: 0; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; z-index: 1000;">
    <button id="prevBtn" style="padding: 12px 24px; font-size: 18px; background-color: #7e7d7b88; color: white; border: none; border-radius: 8px; cursor: pointer;">‚Üê Geri</button>
    <button onclick="goHome()" style="padding: 12px 24px; font-size: 18px; background-color: #7e7d7b88; color: white; border: none; border-radius: 8px; cursor: pointer;">Ana Sayfaya D√∂n</button>
    <button id="nextBtn" style="padding: 12px 24px; font-size: 18px; background-color: #7e7d7b88; color: white; border: none; border-radius: 8px; cursor: pointer;">ƒ∞leri ‚Üí</button>
  </div>

  <button id="readButton" onclick="startStopReading()">üîä Sesli Dinle</button>
</div>

<div class="stats-box" id="statsBox" style="position: fixed; top:1px; right:1px; max-width: 120px;">
  <div style="position: relative; width: 100%; height: 100%;">
    <div>‚úÖ Doƒüru: <span id="correctCount">0</span></div>
    <div>‚ùå Yanlƒ±≈ü: <span id="incorrectCount">0</span></div>
    <div>üìö √ñƒürenilen: <span id="learnedToday">0</span></div>

    <div class="control-overlay" id="pauseToggle">Durdur</div>
  </div>
</div>

<script>
function shuffleArray(array) {
  return array.sort(() => Math.random() - 0.5);
}

const words = [
  { word: "Arbeitsvertrag und K√ºndigung", correct: "i≈ü s√∂zle≈ümesi ve fesih", options: ["√ßalƒ±≈üma izni", "meslek", "tatil"], example: "Er hat den Arbeitsvertrag unterschrieben." },
  { word: "sich identifizieren mit", correct: "√∂zde≈üle≈ümek", options: ["ayrƒ±lmak", "saldƒ±rmak", "karƒ±≈ümak"], example: "Ich identifiziere mich mit der Firma." },
  { word: "im Nachhinein", correct: "sonradan", options: ["ba≈ülangƒ±√ßta", "bug√ºn", "aniden"], example: "Im Nachhinein war es klar." },
  { word: "einen Kredit aufnehmen", correct: "kredi almak", options: ["bor√ß vermek", "para biriktirmek", "sigorta yaptƒ±rmak"], example: "Sie haben einen Kredit aufgenommen." },
  { word: "mit sich bringen", correct: "beraberinde getirmek", options: ["g√∂t√ºrmek", "bƒ±rakmak", "satmak"], example: "Das bringt viele Vorteile mit sich." },
  { word: "der Norm entsprechen", correct: "normlara uymak", options: ["gecikmek", "ihlal etmek", "≈üikayet etmek"], example: "Es entspricht der Norm." },
  { word: "eine T√§tigkeit ausf√ºhren", correct: "bir i≈üi yerine getirmek", options: ["ka√ßmak", "unutmak", "izlemek"], example: "Sie f√ºhrt ihre T√§tigkeit gut aus." },
  { word: "√ºberzeugt sein von", correct: "bir ≈üeye ikna olmak", options: ["≈ü√ºphelenmek", "kƒ±zmak", "uzak durmak"], example: "Er ist √ºberzeugt von seiner Idee." },
  { word: "umgehen mit", correct: "ile ba≈üa √ßƒ±kmak", options: ["uzakla≈ümak", "oynamak", "izlemek"], example: "Sie kann gut mit Stress umgehen." },
];

// Progress verisi localStorage'dan al
let progressData = JSON.parse(localStorage.getItem("progressData") || "{}");

const wordsWithProgress = words.map(w => {
  const progress = progressData[w.word] || { interval: 0, nextReviewDate: null };
  return { ...w, ...progress };
});

function getToday() {
  return new Date().toISOString().split("T")[0];
}

const today = getToday();
const todaysWords = shuffleArray(wordsWithProgress.filter(w => w.nextReviewDate === today));
const newWords = shuffleArray(wordsWithProgress.filter(w => w.nextReviewDate === null));
const extraReviewWords = shuffleArray(wordsWithProgress.filter(w => w.nextReviewDate > today));

let wordsToShow = [];

if (todaysWords.length > 0) {
  wordsToShow = todaysWords;
} else if (newWords.length > 0) {
  wordsToShow = newWords;
} else {
  wordsToShow = shuffleArray(extraReviewWords);
}

let currentIndex = parseInt(localStorage.getItem("currentIndex")) || -1;
const gecikmeSuresi = 4000;

let germanVoice = null;
let turkishVoice = null;

function setGermanVoice() {
  const voices = speechSynthesis.getVoices();
  germanVoice = voices.find(v => v.lang === "de-DE");
  turkishVoice = voices.find(v => v.lang === "tr-TR");
}

function playTurkishAudio(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "tr-TR";
  utterance.rate = 0.8;
  const turkishVoice = speechSynthesis.getVoices().find(v => v.lang === "tr-TR");
  if (turkishVoice) utterance.voice = turkishVoice;
  speechSynthesis.speak(utterance);
}

function playAudio(text) {
  const utterance = new SpeechSynthesisUtterance(" " + text);
  utterance.lang = "de-DE";
  utterance.rate = 0.8;

  if (germanVoice) {
    utterance.voice = germanVoice;
  } else {
    const fallback = speechSynthesis.getVoices().find(v => v.lang === "de-DE");
    if (fallback) utterance.voice = fallback;
  }

  speechSynthesis.cancel();
  speechSynthesis.speak(utterance);
}

let correctCount = 0;
let incorrectCount = 0;
let learnedToday = 0;

function updateStats() {
  document.getElementById("correctCount").innerText = correctCount;
  document.getElementById("incorrectCount").innerText = incorrectCount;
  document.getElementById("learnedToday").innerText = learnedToday;
}

function showWord(index) {
  const current = wordsToShow[index];
  if (!current) return;

  document.getElementById("questionText").innerText = "Kelimenin T√ºrk√ßesi";
  document.getElementById("wordDisplay").innerText = current.word;

  const sentenceBox = document.getElementById("exampleSentence");
  sentenceBox.textContent = "...........";
  sentenceBox.classList.remove("visible");

  const container = document.getElementById("optionsContainer");
  container.innerHTML = "";

  const options = shuffleArray([current.correct, ...current.options]);

  options.forEach(opt => {
    const btn = document.createElement("div");
    btn.className = "option";
    btn.innerText = opt;
    btn.onclick = () => {
      if (opt === current.correct) {
        btn.classList.add("correct");
        document.getElementById("exampleSentence").innerText = current.example;
        document.getElementById("exampleSentence").classList.add("visible");

        playAudio(current.example);
        new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg").play();
        correctCount++;
        learnedToday++;
        updateStats();
        setTimeout(() => {
          if (!isPaused) nextWord();
        }, 7000);

        // TEKRAR ARALIƒûINI G√úNCELLE
        const prev = progressData[current.word] || { interval: 0 };
        const newInterval = prev.interval === 0 ? 1 :
          prev.interval === 1 ? 3 :
          prev.interval === 3 ? 7 :
          prev.interval === 7 ? 15 :
          30;
        const nextDate = new Date();
        nextDate.setDate(nextDate.getDate() + newInterval);
        progressData[current.word] = {
          interval: newInterval,
          nextReviewDate: nextDate.toISOString().split("T")[0]
        };
        localStorage.setItem("progressData", JSON.stringify(progressData));

      } else {
        btn.classList.add("incorrect");
        new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg").play();
        incorrectCount++;
        updateStats();
      }
    };
    container.appendChild(btn);
  });

  playAudio(current.word);
  localStorage.setItem("currentIndex", index);
  currentIndex = index;
}

function nextWord() {
  if (isPaused) return; // Durdurulmu≈üsa ge√ßme
  const nextIndex = (currentIndex + 1) % wordsToShow.length;
  showWord(nextIndex);
}

function prevWord() {
  if (currentIndex > 0) {
    showWord(currentIndex - 1);
  }
}

document.getElementById("speaker").onclick = () => {
  const current = wordsToShow[currentIndex];
  if (current) playAudio(current.word);
};

window.onload = () => {
  window.speechSynthesis.onvoiceschanged = () => {
    setGermanVoice();
  };

  setGermanVoice();

  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");

  if (prevBtn) prevBtn.onclick = prevWord;
  if (nextBtn) nextBtn.onclick = nextWord;

  if (currentIndex === -1 || currentIndex === undefined || currentIndex === null) {
    nextWord();
  } else {
    showWord(currentIndex);
  }
};

function goHome() {
  window.location.href = "index.html";
}

let isReading = false;
let readIndex = 0;
let readInterval;
let isPaused = false;

function startStopReading() {
  if (!isReading) {
    isReading = true;
    readIndex = 0;
    const shuffled = shuffleArray([...words]); // kelimeleri karƒ±≈ütƒ±r
    readWords(shuffled);
  } else {
    isReading = false;
    window.speechSynthesis.cancel(); // konu≈ümayƒ± durdur
    clearTimeout(readInterval);
  }
}

function readWords(list) {
  if (!isReading || readIndex >= list.length) return;

  const w = list[readIndex];
  const sentences = [w.word, w.correct, w.example];
  let sIndex = 0;

  function speakNext() {
    if (!isReading || sIndex >= sentences.length) {
      readIndex++;
      readInterval = setTimeout(() => readWords(list), 1000);
      return;
    }

    const utter = new SpeechSynthesisUtterance(sentences[sIndex]);
    utter.lang = sIndex === 1 ? "tr-TR" : "de-DE";

    if (utter.lang === "de-DE" && germanVoice) {
      utter.voice = germanVoice;
      utter.rate = 0.9;
    }

    if (utter.lang === "tr-TR" && turkishVoice) {
      utter.voice = turkishVoice;
      utter.rate = 0.8;
    }

    speechSynthesis.cancel();

    if (utter.lang === "de-DE" && germanVoice) {
      utter.voice = germanVoice;
    }

    window.speechSynthesis.speak(utter);
    sIndex++;
    utter.onend = () => {
      setTimeout(speakNext, 1000);
    };
  }

  speakNext();
}

const pauseToggle = document.getElementById('pauseToggle');

pauseToggle.addEventListener('click', () => {
  isPaused = !isPaused;

  if (isPaused) {
    pauseToggle.textContent = 'Devam Et';
    pauseToggle.classList.add('paused');
  } else {
    pauseToggle.textContent = 'Durdur';
    pauseToggle.classList.remove('paused');
  }

  
});
</script>
</body>
</html>
