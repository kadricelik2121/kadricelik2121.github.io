<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>Polly MP3 + E≈üzamanlƒ± Metin (Senkron ƒ∞yile≈ütirilmi≈ü)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0b1020; --card:#12172a; --muted:#aab1c8; --text:#eaf0ff; --active:#1e2b55; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    header{padding:16px 20px;background:linear-gradient(180deg,#101735,#0b1020)}
    h1{margin:0;font-size:18px}
    .container{max-width:980px;margin:18px auto;padding:0 16px 40px}
    .panel{background:var(--card);border:1px solid #22305a;border-radius:16px;padding:14px}
    audio{width:100%;margin:8px 0 2px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;color:var(--muted);font-size:14px}
    .row input[type="number"]{width:90px;background:#0f1530;border:1px solid #293763;border-radius:8px;color:#cfe2ff;padding:6px}
    .btn{background:#141b34;color:var(--text);border:1px solid #22305a;border-radius:12px;padding:9px 12px;cursor:pointer}
    .btn:hover{background:#182043}
    h2{margin:0 0 10px;font-size:16px;color:#cfe2ff}
    ol#transcript{list-style:decimal;margin:0;padding:10px 0 10px 24px;max-height:72vh;overflow:auto;scroll-behavior:smooth}
    ol#transcript li{padding:12px 14px;margin:6px 0;border-radius:14px;line-height:1.55;font-size:18px;border:1px solid transparent;cursor:pointer}
    ol#transcript li:hover{background:#161d39}
    ol#transcript li.active{background:var(--active);border-color:#2c447f;box-shadow:inset 0 0 0 1px #2f4c97}
    .fake{display:none}
    .kbd{font-family:ui-monospace,Consolas,monospace;background:#0d1226;border:1px solid #26335e;border-radius:6px;padding:2px 6px;color:#cde}
 

  </style>
</head>
<body>
  <header><h1>Amazon Polly MP3 + E≈üzamanlƒ± Metin (Senkron ƒ∞yile≈ütirilmi≈ü)</h1></header>

  <div class="container">
    <div class="panel">
      <!-- MP3 sabit (dosyayƒ± aynƒ± klas√∂re koy) -->
      <audio id="audio" controls preload="auto">
        <source src="speech_20250830233033430.mp3" type="audio/mpeg" />
      </audio>

      <div class="row" style="margin-top:8px">
        <span>Okuma hƒ±zƒ± (kelime/sn):</span>
        <input id="wps" type="number" step="0.1" min="0.8" value="1.9">
        <span>Her c√ºmleye ek durak (sn):</span>
        <input id="pad" type="number" step="0.1" min="0" value="0.6">
        <span>Senkron ofseti (sn):</span>
        <input id="offset" type="number" step="0.05" value="0">
        <button id="recalc" class="btn">üîÅ Otomatik Zamanlarƒ± Yenile</button>
        <button id="toggleMark" class="btn">‚è±Ô∏è Zaman ƒ∞≈üaretleme: Kapalƒ±</button>
        <button id="markNow" class="btn" title="Ctrl+Space">üìç ≈ûu Anƒ± ƒ∞≈üaretle</button>
        <span class="row" style="gap:4px;color:#aab1c8">Kƒ±sayol: <span class="kbd">Ctrl</span> + <span class="kbd">Space</span></span>
      </div>
    </div>

    <div class="panel" style="margin-top:14px">
      <h2>Metin</h2>
      <ol id="transcript"></ol>
    </div>
  </div>

  <script>
  // --- Metin (son Almanca hali) ---
  const sentences = [
    "Heute m√∂chte ich Ihnen eine pers√∂nliche Geschichte erz√§hlen, <span class='fake'>............, .........., ........., ........, ........., ........,  ...</span>",
    "Letztes Jahr sind wir als Familie in die Schweiz gefahren, um meinen Onkel zu besuchen.",
    "Auf den ersten Blick wirkte es wie ein normaler Familienbesuch, aber innerlich hatte ich gro√üe Angst.<span class='fake'>............, .........., ........., ........, ........., ........,  ...</span>",
    "Denn immer wenn mein Onkel bei mir etwas Neues bemerkte", 
    "sei es ein Auto oder ein wertvoller Gegenstand.<span class='fake'> .........., ........., ........, ........., ........,  ...</span>",
    "ging dieser Gegenstand kurze Zeit sp√§ter kaputt.<span class='fake'>............, .........., ........., ........, ........., ........,  ...</span>",
    "In unserer Kultur nennt man das den ‚Äûb√∂sen Blick.<span class='fake'>........, ........., ........,  ...</span>",
    "Auch wenn ich nicht wirklich daran glaubte,",
    "haben mich diese Erfahrungen trotzdem sehr gepr√§gt.<span class='fake'>............, .........., ........., ........, ........., ........,  ...</span>",
    "Dieses Mal hatten wir ein neues Auto dabei, das mein Onkel noch nie gesehen hatte.<span class='fake'> ........., ........, ........., ........,  ...</span>",
    "W√§hrend meine Frau und ich vor der Reise √ºber unsere Sorgen sprachen,",
     "hielten wir diese geheim, damit unsere Kinder nichts merkten.",
    "Am Tag vor der Reise schlug meine Frau vor, ein Nazar-Amulett ins Auto zu h√§ngen.",
    "Ich glaubte zwar nicht daran, aber weil sie sich dadurch besser f√ºhlte, stimmte ich zu.<span class='fake'>............, .........., ........., ........, ........., ........,  ...</span>",
    "In Gie√üen fanden wir ein Nazar-Amulett und h√§ngten es an den R√ºckspiegel.<span class='fake'>............, .........., ........., ........, ........., ........,  ...</span>",
    "Immer wenn ich den Anh√§nger im R√ºckspiegel ansah, dachte ich innerlich:", 
    "Falls es den b√∂sen Blick wirklich gibt, wird die Scheibe genau hier zerbrechen,<span class='fake'>............, .........., ........., ........, ........., ........,  ...</span>",
    "Schlie√ülich kamen wir bei meinem Onkel an.",
    "Er empfing uns freundlich, betrachtete das Auto genau, aber es passierte nichts, <span class='fake'> ........., ........,  ...</span>",
    "und ich war erleichtert.",
    "Am n√§chsten Morgen machten wir noch einen kurzen Ausflug, <span class='fake'> ........, ........., ........,  ...</span>",
    "bevor wir uns verabschiedeten und meinen Onkel ein letztes Mal besuchten,<span class='fake'>........, ........., ........,  ...</span>",
    "Als wir uns jedoch auf dem R√ºckweg befanden", 
    "standen wir pl√∂tzlich auf einem Bahn√ºbergang, und die Schranke senkte sich direkt vor uns,<span class='fake'> ........, ........., ........,  ...</span>",
    "Obwohl wir eigentlich genug Zeit gehabt h√§tten, wegzufahren, blieb ich wie gel√§hmt sitzen und konnte mich nicht bewegen.<span class='fake'>............, .........., .........., .........., .........., ........., ........, ........., ........,  ...</span>",
    "Die Schranke schlug gegen die Frontscheibe, sodass sowohl die Scheibe als auch der vordere Teil des Autos besch√§digt wurden,<span class='fake'>, .........., ........., ........, ........., ........,  ...</span>",
    "Und das Merkw√ºrdigste war: Die Scheibe zerbrach genau an der Stelle, von der ich zuvor gedacht hatte,",
     "Wenn es den b√∂sen Blick gibt, dann wird sie hier zerbrechen.",
    "Zum Schluss m√∂chte ich sagen:", 
    "Egal ob man an etwas Gutes oder Schlechtes glaubt.",
    "sobald man stark genug daran glaubt, √ºbernimmt dieser Glaube irgendwann die Kontrolle, <span class='fake'>  ........, ........., ........,  ...</span>",
    "denn unser Gehirn verwandelt das, was wir denken, in Realit√§t.",
    "Mein Vortrag endet hier, vielen Dank f√ºr Ihre Aufmerksamkeit."
  ];


  // --- DOM ---
  const audio = document.getElementById('audio');
  const transcriptEl = document.getElementById('transcript');
  const wpsInput = document.getElementById('wps');
  const padInput = document.getElementById('pad');
  const offsetInput = document.getElementById('offset');
  const recalcBtn = document.getElementById('recalc');
  const toggleMarkBtn = document.getElementById('toggleMark');
  const markNowBtn = document.getElementById('markNow');

  // --- Metni √ßiz ---
  sentences.forEach((s, i) => {
    const li = document.createElement('li');
   li.innerHTML = s;
    li.dataset.index = i;
    li.addEventListener('click', () => { audio.currentTime = (timings[i]||0); audio.play(); });
    transcriptEl.appendChild(li);
  });

  // --- Otomatik tahmini zamanlar ---
  function wordsOf(s){ return (s.match(/[^\s‚Äì‚Äî-]+/g) || []).length; }
  function buildAutoTimings(wps=1.9, pad=0.6){
    const t=[]; let acc=0;
    for(const s of sentences){ t.push(+acc.toFixed(2)); acc += wordsOf(s)/wps + pad; }
    return t;
  }
  let timings = buildAutoTimings();

  // --- Hassas senkron: rAF + histerezis ---
  let lastActive=-1, rafId=null;
  function midpoint(i){
    const a = timings[i]??0, b = timings[i+1]??(a+4);
    return a + (b-a)/2; // ortasƒ±nƒ± al
  }
  function chooseIndex(t){
    // global offset uygula
    t = t + parseFloat(offsetInput.value||0);
    // en uygun index: t, i ve i+1 orta noktasƒ± kƒ±yas
    let i = 0;
    // binary search (timings artan)
    let lo=0, hi=timings.length-1;
    while(lo<=hi){
      const mid = (lo+hi)>>1;
      if (timings[mid] <= t) { i = mid; lo = mid+1; } else { hi = mid-1; }
    }
    // histerezis: bir sonraki c√ºmleye, orta noktayƒ± ge√ßince ge√ß
    if (i < timings.length-1 && t >= midpoint(i)) i++;
    return i;
  }
  function loop(){
    const t = audio.currentTime;
    const i = chooseIndex(t);
    if(i!==lastActive){
      // highlight deƒüi≈üimi
      transcriptEl.querySelector('.active')?.classList.remove('active');
      const li = transcriptEl.querySelector(`li[data-index="${i}"]`);
      if(li){ li.classList.add('active'); li.scrollIntoView({block:'center', behavior:'smooth'}); }
      lastActive=i;
    }
    rafId = requestAnimationFrame(loop);
  }
  audio.addEventListener('play', ()=> { cancelAnimationFrame(rafId); rafId = requestAnimationFrame(loop); });
  audio.addEventListener('pause', ()=> cancelAnimationFrame(rafId));
  audio.addEventListener('ended', ()=> cancelAnimationFrame(rafId));

  // --- Ayarlarƒ± deƒüi≈ütir ---
  function recalc(){
    const wps = parseFloat(wpsInput.value)||1.9;
    const pad = parseFloat(padInput.value)||0.6;
    timings = buildAutoTimings(wps,pad);
  }
  recalcBtn.addEventListener('click', recalc);

  // --- ƒ∞steƒüe baƒülƒ± manuel i≈üaretleme (sade, JSON yok) ---
  let markMode=false, markPtr=0;
  function setMarkMode(on){
    markMode = on; markPtr = 0;
    toggleMarkBtn.textContent = `‚è±Ô∏è Zaman ƒ∞≈üaretleme: ${on?'A√ßƒ±k':'Kapalƒ±'}`;
    if(on){ timings = new Array(sentences.length).fill(0); }
  }
  toggleMarkBtn.addEventListener('click', ()=> setMarkMode(!markMode));
  function markNow(){
    if(!markMode || markPtr>=sentences.length) return;
    timings[markPtr] = +(audio.currentTime + parseFloat(offsetInput.value||0)).toFixed(2);
    markPtr++;
  }
  markNowBtn.addEventListener('click', markNow);
  window.addEventListener('keydown', (e)=>{
    if(e.ctrlKey && e.code==='Space'){ e.preventDefault(); markNow(); }
  });
  </script>
</body>
</html>
